/**
 * Server calls of application client.
 */
import {Uri} from "uu_appg01_core"
import {Client} from "uu_appg01"

let Calls = {

  call(method, url, dtoIn, clientOptions) {
    Client[method](url, dtoIn.data || null, clientOptions).then(
      response => dtoIn.done(response.data),
      response => dtoIn.fail(response)
    );
  },

  getCommandUri(aUseCase, params = {}) { // useCase <=> "/getSomething" or "/sys/getSomething"
    let useCase = !aUseCase.match(/^\//) ? "/" + aUseCase : aUseCase;
    let baseUri = `${params.baseUri}/${params.appCode}/${params.tidAwid}`; //dev116
    let uriBuilder = Uri.UriBuilder.parse(baseUri).setUseCase(useCase);
    for (let param in params) {
      uriBuilder.setParameter(param, params[param]);
    }
    return uriBuilder.toUri();
  },

  getBookBasicInfo(dtoIn) {
    let useCase = "/getProductInfo";
    let baseUri = `${dtoIn.data.baseUri}/${dtoIn.data.appCode}/${dtoIn.data.tidAwid}`;
    let commandUri = Uri.UriBuilder.parse(baseUri).setUseCase(useCase).toUri();
    delete dtoIn.data;
    Calls.call("get", commandUri.toString(), dtoIn);
  },
};

export default Calls;
