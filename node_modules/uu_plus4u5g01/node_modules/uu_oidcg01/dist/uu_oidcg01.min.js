/*! uu_oidcg01, 3.2.1, 2017-11-23 13:57:04Z */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("uu_appg01_core"),require("module")):"function"==typeof define&&define.amd?define("UuOidc",["uu_appg01_core","module"],t):"object"==typeof exports?exports.UuOidc=t(require("uu_appg01_core"),require("module")):e.UuOidc=t(e.UuApp,e.undefined)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i=n(13),r=((i?i.uri:(document.currentScript||Array.prototype.slice.call(document.getElementsByTagName("script"),-1)[0]||{}).src)||"").toString();n.p=r.split(/\//).slice(0,-1).join("/")+"/",e.exports=n(19)},function(t,n){t.exports=e},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=i(r),s=n(7),a=i(s),u={},l={getMetadata:function(e){var t=e.replace(/\/+$/,""),n=u[t];if(n)return n;var i=l.getMetadataUri(t);return u[t]=a.default.wrapForImmediateThen(o.default.get(i).catch(function(e){throw delete u[t],e}))},getMetadataUri:function(e){var t=e.replace(/\/+$/,"");return t+"/.well-known/openid-configuration"}};t.default=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=document.createElement("a");return t.href=e,t.href.toString()}function s(e){return("0"+e.getHours()).substr(-2)+":"+("0"+e.getMinutes()).substr(-2)+":"+("0"+e.getSeconds()).substr(-2)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(1),l=n(14),c=i(l),f=n(4),d=i(f),h=n(15),p=i(h),g=n(25),m=i(g),v=n(26),_=i(v),y=n(7),w=i(y),k=n(12),b=i(k),x=n(6),O=i(x),C=n(17),T=i(C),R=n(2),S=i(R),I=u.Error.Error,E=u.Logging.LoggerFactory.get("UuOidc.Session"),P=function(){function e(t){var n=this;if(r(this,e),!t)throw new I("Session must be initialized with proper options or UuApp.Util.Config.");this._optionsMergedPromise=w.default.wrapForImmediateThen(Promise.resolve(t&&"function"==typeof t.get?t.initPromise||t:t).then(function(e){if(Object.keys(c.default).forEach(function(t){var i=void 0;e&&"function"==typeof e.get?i=e.get("uuoidc."+t,!1):e&&(i=e[t]),null==i&&(i=c.default[t]),n["redirectUri"===t?"implicitFlowRedirectUri":t]=i}),n.clientId||(n.clientId="uu-oidc:unregistered-client:"+(0,m.default)()),!n.implicitFlowRedirectUri.match(/^[a-z]+:/i)){var t=o(document.baseURI||location.pathname).replace(/^([^?#]*\/).*/,"$1");"/"!=n.implicitFlowRedirectUri.charAt(0)?n.implicitFlowRedirectUri=o(t+n.implicitFlowRedirectUri):n.implicitFlowRedirectUri=o(n.implicitFlowRedirectUri)}("number"!=typeof n.sessionExpiringNotificationTime||n.sessionExpiringNotificationTime<0)&&(n.sessionExpiringNotificationTime=c.default.sessionExpiringNotificationTime),("number"!=typeof n.sessionCheckInterval||n.sessionCheckInterval<0)&&(n.sessionCheckInterval=c.default.sessionCheckInterval),n.sessionCheckInterval>0&&n.sessionCheckInterval<2&&(n.sessionCheckInterval=2),("number"!=typeof n.tokenRefreshLeeway||n.tokenRefreshLeeway<0)&&(n.tokenRefreshLeeway=c.default.tokenRefreshLeeway),("number"!=typeof n.tokenRefreshFailureRetryInterval||n.tokenRefreshFailureRetryInterval<0)&&(n.tokenRefreshFailureRetryInterval=c.default.tokenRefreshFailureRetryInterval),n.tokenRefreshFailureRetryInterval>0&&(n.tokenRefreshFailureRetryInterval=Math.max(5,n.tokenRefreshFailureRetryInterval)),n.sessionCheckInterval&&(n._sessionChecker=new T.default(n),n._sessionChecker.onStateChange(function(){E.debug("Session state change detected."),n.isAuthenticated()&&n._silentTokenRefresh(!0)}))})),this._loginInProgress=0,this._silentTokenRefreshInProgress=0,this.nonce=Math.random().toString(32).substr(2);var i={};this.addListener=function(e,t){var r=i[e];return r||(r=i[e]=[]),r.push(t),n.removeListener.bind(n,e,t)},this.removeListener=function(e,t){var n=i[e];if(!n)return!1;var r=n.indexOf(t);return r!=-1&&n.splice(r,1),r!=-1},this._runListeners=function(e,t){E.debug('Launching event "'+e+'."');var r=i[e];if(r){var o={type:e,data:t};r.forEach(function(e){return e.call(n,o)})}"identityChange"===e&&i.__identityChange&&i.__identityChange.forEach(function(e){return e.call(n,t)})},this.isAuthenticated=function(){return!!n._loginCtx},this.addIdentityChangeListener=this.addListener.bind(this,"__identityChange"),this.removeIdentityChangeListener=this.removeListener.bind(this,"__identityChange"),this.addListener("identityChange",function(e){var t=(n._loginCtx||{}).authResponse;t&&t.session_expires_in&&(t.session_expires_at||(t.session_expires_at=Math.floor(Date.now()/1e3)+Number(t.session_expires_in)))}),this.addListener("identityChange",function(e){n._autoLogoutTimeout&&(clearTimeout(n._autoLogoutTimeout),delete n._autoLogoutTimeout);var t=(n._loginCtx||{}).authResponse;if(t){var i=t.session_expires_at||(n.getClaims()||{}).exp;if(i){var r=(new Date).getTime(),o=Math.max(0,1e3*i-r);E.debug("Planning local auto-logout at "+s(new Date(r+o))+"."),n._autoLogoutTimeout=setTimeout(function(){delete n._autoLogoutTimeout,n._localLogout()},o)}}});var a=0;this.addListener("identityChange",function(e){if(n.tokenRefreshEnabled){n._sessionRefreshTimeout&&(clearTimeout(n._sessionRefreshTimeout),delete n._sessionRefreshTimeout);var t=n.getClaims(),i=(t||{}).exp;if(i){var r=(new Date).getTime(),o=Math.max(1e3*i-r-1e3*n.tokenRefreshLeeway,Math.max(0,1e3-(r-a)));E.debug("Planning token auto-refresh at "+s(new Date(r+o))+"."),n._sessionRefreshTimeout=setTimeout(function(){delete n._sessionRefreshTimeout,a=(new Date).getTime(),n._silentTokenRefresh()},o)}}}),this.addListener("identityChange",function(e){var t=1e4,i=(n._loginCtx||{}).authResponse,r=n._activeSessionExpiresAtMillis&&i&&1e3*i.session_expires_at>n._activeSessionExpiresAtMillis+t;if(n._activeSessionExpiresAtMillis=i?1e3*i.session_expires_at:null,r){n._sessionExpiringBlocked=!1;var o=n._activeSessionExpiresAtMillis;setTimeout(function(){n._runListeners("sessionExtended",{expiresAt:o})},0)}});var u=void 0;this.addListener("identityChange",function(e){if(!(n.sessionExpiringNotificationTime<=0)){n._sessionExpiringTimeout&&(clearTimeout(n._sessionExpiringTimeout),delete n._sessionExpiringTimeout);var t=(n._loginCtx||{}).authResponse,i=(n.getClaims()||{}).sub;if(i!=u&&(n._sessionExpiringBlocked=!1),u=i,t&&t.session_expires_at&&!n._sessionExpiringBlocked){var r=1e3*t.session_expires_at,o=Date.now(),a=Math.max(0,r-o-1e3*n.sessionExpiringNotificationTime);E.debug("Planning sessionExpiring notification at "+s(new Date(o+a))+"."),n._sessionExpiringTimeout=setTimeout(function(){delete n._sessionExpiringTimeout,n._sessionExpiringBlocked=!0,n._runListeners("sessionExpiring",{expiresAt:r})},a)}}})}return a(e,[{key:"getIdentity",value:function(){return this._loginCtx?this._loginCtx.getIdentity():null}},{key:"getClaims",value:function(){return this._loginCtx?this._loginCtx.getClaims():null}},{key:"login",value:function(e){var t;return e&&(t=Object.keys(e).reduce(function(t,n){return t[b.default.toSnakeCase(n)]=e[n],t},{})),this._login(t)}},{key:"_login",value:function(t,n){var i,r=this,o=Object.assign({},t);"urn:ietf:params:oauth:token-type:jwt-uuos8"===o.token_type_hint&&(i=o.access_token,delete o.access_token,delete o.token_type_hint);var s=o.access_token;delete o.access_token;var a=function(){if(++r._loginInProgress,0==Object.keys(o).length&&(o.acr_values=1),!s&&r._loginCtx){var e=!0;(o.prompt||o.max_age||o.access_token)&&(e=!1);var t=(null!=o.acr_values?o.acr_values+"":"").split(/\s+/),a=r.getIdentity();if(t.every(function(e){return Number(e)>a.loginLevelOfAssurance})&&(e=!1),d.default.isAuthResponseExpired(r._loginCtx.authResponse)&&(e=!1),e)return--r._loginInProgress,Promise.resolve(r)}var u=s?{id_token:s}:null,l=s||i||"nonce"in o?o.nonce:r.nonce;o.nonce=l,delete o.state;var c=Promise.resolve(u||w.default.immediateThen(r._optionsMergedPromise,function(){if(i){var e=new _.default({serverUri:r.serverUri,clientId:r.clientId,redirectUri:r.implicitFlowRedirectUri});return e.grantExchangeToken({subject_token:i})}return o.state=Math.random().toString(32).substr(2),navigator.standalone&&(o.state+=","+location.pathname+location.search+(location.hash.length>1?location.hash:"")),d.default.login({serverUri:r.serverUri,clientId:r.clientId,redirectUri:r.implicitFlowRedirectUri,loginParams:o})},function(e){return Promise.reject(e)}));return c.then(function(e){return r._optionsMergedPromise.then(function(){return d.default.validateAuthResponse(e,{serverUri:r.serverUri,clientId:r.clientId,loginParams:o})})}).then(function(e){var t=e.authResponse,i=e.claims;return n&&n({authResponse:t,claims:i})===!1||(r._loginCtx=new p.default(o,t,i),r._runListeners("identityChange",r.getIdentity())),r}).then(function(e){return--r._loginInProgress,e},function(e){return--r._loginInProgress,Promise.reject(e)})};return this!==e.currentSession||s||i||0!==Object.keys(o).length?a():w.default.immediateThen(e.initPromise,a)}},{key:"_silentTokenRefresh",value:function(e){var t=this;if(!e||!(this._silentTokenRefreshTimeout||this._silentTokenRefreshInProgress>0)){this._silentTokenRefreshTimeout&&(clearTimeout(this._silentTokenRefreshTimeout),delete this._silentTokenRefreshTimeout);var n=0,i=function e(){if(t.isAuthenticated())return E.debug("Silent token refresh - starting."),++t._silentTokenRefreshInProgress,++n,t._login({acr_values:"1",prompt:"none"},function(e){var n=e.claims;return--t._silentTokenRefreshInProgress,t.isAuthenticated()?n.sub!==t.getClaims().sub?(E.debug("Silent token refresh - ending with local logout (user that is logged in on remote is different from the local one)."),t._localLogout(),!1):(E.debug("Silent token refresh - ending with token renewed."),!0):(E.debug("Silent token refresh - ending with no-op (local session is already logged out)."),!1)}).catch(function(i){var r=i&&i.error?i.error:i;return d.default.isLoggedOutError(i)?(E.debug("Silent token refresh - ending with local logout (user is not logged in on remote)."),void t._localLogout()):(!t._silentTokenRefreshTimeout&&t.tokenRefreshFailureRetryInterval?(E.debug("Silent token refresh - will retry in "+t.tokenRefreshFailureRetryInterval+"s (operation ended with unexpected error).",{error:r}),t._silentTokenRefreshTimeout=setTimeout(function(){delete t._silentTokenRefreshTimeout,e()},1e3*t.tokenRefreshFailureRetryInterval)):t._silentTokenRefreshTimeout?E.debug("Silent token refresh - ending current run with no-op (operation ended with unexpected error and another retry is already planned).",{error:r}):E.debug("Silent token refresh - ending with no-op (operation ended with unexpected error).",{error:r}),void(1===n?console.warn("Token refresh failed with error:",r):2===n&&console.warn("Suppressing further notifications of token refresh problem to prevent log cluttering (until success or logout).")))})};i()}}},{key:"_localLogout",value:function(){E.debug("Performing local-logout."),this._loginCtx&&(delete this._loginCtx,this._runListeners("identityChange",this.getIdentity()))}},{key:"logout",value:function(){var e=this;return this._loginCtx?this._optionsMergedPromise.then(function(){return S.default.getMetadata(e.serverUri).then(function(t){return new Promise(function(n,i){if(!e._loginCtx)return n();var r=e.implicitFlowRedirectUri,o=t.end_session_endpoint+"?post_logout_redirect_uri="+encodeURIComponent(r)+"&id_token_hint="+encodeURIComponent(e._loginCtx.authResponse.id_token);new O.default({url:o,onResult:function(t){t instanceof Error?(t.message="Logout failed."+(t.message?" "+t.message:""),i(t)):(e._localLogout(),n())}}).render()})})}):Promise.resolve()}},{key:"getCallToken",value:function(e){var t=(this._loginCtx||{}).authResponse;if(!t)return null;var n={tokenType:t.token_type||null,token:t.id_token||null};return n}}]),e}();t.default=P;var j,U=!0;Object.defineProperty(P,"currentSession",{get:function(){return U&&!j&&(j=new P(u.Util.Config),j.initComplete=!1,j.initPromise=P.initPromise),j},set:function(e){U=!1,j=e}});var M;P.initPromise=w.default.wrapForImmediateThen(new Promise(function(e,t){M=function(t,n){return P.initComplete=!0,P.currentSession.initComplete=!0,t||console.log("Session initialization failed:",n),e(P.currentSession),P.initPromise}})),P.initPromise._finalizeInit=M,P.initComplete=!1},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(2),s=i(o),a=n(7),u=i(a),l=n(24),c=i(l),f=n(6),d=i(f),h=n(21),p=i(h),g=n(5),m=i(g),v=n(20),_=i(v),y=300,w={login:function(e){var t=e||{},n=t.serverUri;if(!n)throw new Error("ImplicitFlow.login requires option 'serverUri'.");var i=t.clientId;if(!i)throw new Error("ImplicitFlow.login requires option 'clientId'.");var r=t.redirectUri;if(!r)throw new Error("ImplicitFlow.login requires option 'redirectUri'.");return u.default.immediateThen(s.default.getMetadata(n),function(e){var n=Object.assign({scope:"openid"},t.loginParams,{response_type:"id_token token",client_id:i,redirect_uri:r}),o=[];for(var s in n){var a=n[s];null!=a&&o.push(encodeURIComponent(s)+"="+encodeURIComponent(a+""))}var u=e.authorization_endpoint+"?"+o.join("&"),l=t.loginVisualComponent||("none"!=n.prompt?c.default:d.default);return new Promise(function(e,t){new l({url:u,onResult:function(n){var i=w.getAuthResponseFromCallback(n);return i===!1?t(new Error("User refused to log in.")):i===c.default.ERROR_POPUP_BLOCKED?t(new Error("Login failed due to popup blocking.")):void(i.error?t(i):e(i))}}).render()})},function(e){return Promise.reject(e)})},validateAuthResponse:function(e,t){if(t.loginParams.state&&e.state!==t.loginParams.state)throw new Error("Invalid 'state' in received authorization response. Expected "+t.loginParams.state+" but got "+e.state+". Response: "+JSON.stringify(e));if(w.isAuthResponseExpired(e))throw new Error("Token expired "+JSON.stringify(e));return w.validateIdToken(e.id_token,t).then(function(t){return{authResponse:e,claims:t}})},isAuthResponseExpired:function(e){var t=(new Date).getTime()/1e3,n=60,i=!1;return e.issued_at||(e.issued_at=t),e.expires_at&&(i=i||e.expires_at<t-n),e.expires_in&&e.issued_at&&(i=i||Number(e.expires_in)+Number(e.issued_at)<t-n),i},isLoggedOutError:function(e){return e&&"object"==("undefined"==typeof e?"undefined":r(e))&&"string"==typeof e.error_description&&e.error_description.match(/interaction/i)&&e.error_description.match(/required/i)},validateIdToken:function(e,t){var n=t.serverUri,i=t.loginParams.nonce;return s.default.getMetadata(n).then(function(t){var r={alg:["RS256"],iss:[t.issuer],gracePeriod:y};return p.default.decode(e,r,function(i){if(!i.alg||!i.alg.match(/^RS\d+$/))throw new Error("Invalid token. Only RSA signature is supported, but token uses algorithm '"+i.alg+"'. Token: "+e);var r="RSA",o=t.id_token_signing_alg_values_supported||[];if(o.indexOf(i.alg)==-1)throw new Error("Invalid token. Token was signed using algorithm '"+i.alg+"' but the OIDC server '"+n+"' supports only "+JSON.stringify(o)+". Token: "+e);var s=new _.default({serverUri:n});return s.getKey(i.kid,r).catch(function(t){throw new Error("Invalid token. Unable to match key from JWT header to list of keys used by OpenID Connect server "+n+". Token: "+e,t)})}).then(function(e){if(i&&e.nonce!==i)throw new m.default("Invalid nonce in ID token claims. Expected "+i+" but got "+e.nonce);return e})})},getAuthResponseFromCallback:function(e){if(e===!1||e===c.default.ERROR_POPUP_BLOCKED)return e;if(e instanceof Error)return{error:e};var t={};return e.replace(/^[^#]*#?/,"").split(/&/).forEach(function(e){var n=e.indexOf("="),i=decodeURIComponent((n==-1?e.substr(0):e.substr(0,n)).replace(/\+/g," ")),r=decodeURIComponent((n==-1?"":e.substr(n+1)).replace(/\+/g," "));t[i]=r}),t}};t.default=w},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.Error.Error);t.default=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=i(r),s=n(1),a=function(e){var t=Object.assign({},e),n={iframe:null};Object.defineProperty(n,"loginWindow",{get:function(){try{return null!=n.iframe?n.iframe.contentWindow:null}catch(e){}return null}}),o.default.registerForCallback(this,n),this.finalize=function(e){this.finalize=function(){},this.destroy(),t.onResult&&t.onResult(e)}.bind(this),this.render=function(){var e=this;n.iframe||(n.iframe=document.createElement("iframe"),n.iframe.style.cssText="position: absolute;top: -300px; left: -300px; width: 200px; height: 200px; opacity: 0;",n.iframe.src=t.url,n.iframe.onload=function(){return e.finalize(new Error("OIDC iframe doesn't contain proper callback HTML page - check that your network is up & running. Alternatively, an error might have happened on OIDC server while processing URL "+t.url+" or the application sent wrong redirect_uri."))},n.iframe.onerror=function(){return e.finalize(new Error("OIDC iframe doesn't contain proper callback HTML page - check that your network is up & running. Alternatively, an error might have happened on OIDC server while processing URL "+t.url+" or the application sent wrong redirect_uri."))},document.body.appendChild(n.iframe),t.timeout&&(this._timeout=setTimeout(function(){e.finalize(new s.Error.TimeoutError("OIDC iframe didn't receive callback within "+t.timeout+"s."))},1e3*t.timeout)))},this.destroy=function(){n.iframe&&n.iframe.parentNode&&n.iframe.parentNode.removeChild(n.iframe),this.destroy=function(){},this._timeout&&clearTimeout(this._timeout),o.default.unregisterForCallback(this)}};t.default=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={wrapForImmediateThen:function(e){return e.then(function(t){return e._immediateValue=t},function(t){return e._immediateError=t}),e},immediateThen:function(e,t,n){if("_immediateValue"in e)return"function"==typeof t?t(e._immediateValue):e._immediateValue;if("_immediateError"in e){if("function"==typeof n)return n(e._immediateError);throw e._immediateError}return e.then(t,n)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="uuOidcCallbackFn";"undefined"==typeof window||window[n]||(window[n]=function(e,t){for(var i=window[n].loginWindows,r=0;r<i.length;++r){var o=i[r];if(o.state.loginWindow==t)return void o.component.finalize(e)}console.warn("Received unexpected callback from window",t,"Passed result was:",e,"Ignoring the callback.")},window[n].loginWindows=[]),t.default={registerForCallback:function(e,t){window[n].loginWindows.push({component:e,state:t})},unregisterForCallback:function(e){for(var t=window[n].loginWindows,i=0;i<t.length;++i)if(t[i].component===e){t.splice(i,1);break}}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={encodeAscii:function(e){return e?btoa(e).replace(/\+/g,"-").replace(/\//g,"_"):e},encode:function(e){return e?n.encodeAscii(unescape(encodeURIComponent(e))):e},decodeToAscii:function(e){if(!e)return null;var t=e.replace(/-/g,"+").replace(/_/g,"/");return atob(t)},decode:function(e){var t=n.decodeToAscii(e);return null!=t?decodeURIComponent(escape(t)):null}};t.default=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new Function("try {return this===window;}catch(e){ return false;}")(),i=n?"interactive"===document.readyState||"complete"===document.readyState?Promise.resolve():new Promise(function(e){document.addEventListener("DOMContentLoaded",e,!1)}):Promise.resolve();t.default={domReady:i}},function(e,t){"use strict";function n(e,t,n,i){return new Promise(function(r,o){var s=new XMLHttpRequest;s.open(e,t,!0),s.withCredentials=!0,s.setRequestHeader("Accept","application/json"),s.onreadystatechange=function(e){if(4==s.readyState)if(s.status>=200&&s.status<300)try{var t=JSON.parse(s.responseText);r(t)}catch(e){o(e)}else o(new Error("Server responded with status "+s.status))},s.withCredentials=!0,i&&i(s),s.send(n)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:function(){return n.bind(this,"GET").apply(this,Array.prototype.slice.call(arguments))},post:function(){return n.bind(this,"POST").apply(this,Array.prototype.slice.call(arguments))}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={toSnakeCase:function(e){return(e||"").replace(/[A-Z]/g,function(e){return"_"+e.toLowerCase()})}}},function(e,n){e.exports=t},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={serverUri:"https://oidc.plus4u.net/uu-oidcg01-main/99923616732452117-4f06dafc03cb4c7f8c155aa53f0e86be",clientId:null,redirectUri:"callbacks/oidc-callback.html",sessionCheckInterval:5,sessionExpiringNotificationTime:300,tokenRefreshEnabled:!0,tokenRefreshLeeway:300,tokenRefreshFailureRetryInterval:30}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t,i,r){n(this,e),this.loginOptions=t,this.authResponse=i,this.claims=r,this.getClaims=function(){return r};var o;this.getIdentity=function(){return o?o:o={id:r.sub,name:r.name,email:r.email,uuIdentity:r.uu_identity,levelOfAssurance:Number(r.loa),loginLevelOfAssurance:Number(r.acr)}}};t.default=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e,t,n){function i(r){if(++l>5)throw new u.Error.AbortError("Command invocation stopped because user was not able to fulfill login requirements for the command within "+l+" attempts.");var c=Object.assign({},a,r);return(Object.keys(c).length>0?o._login(c):Promise.resolve(o)).catch(function(e){if(e===!1)throw new u.Error.AbortError("Command invocation stopped because user refused to log in.");throw new u.Error.Error("Command invocation stopped because of a login error.",e)}).then(function(e){var t=e.isAuthenticated();return t?Promise.resolve(e.getCallToken()).then(function(e){return{isAuthenticated:t,callToken:e}}):{isAuthenticated:t,callToken:null}}).then(function(r){var o=r.isAuthenticated,a=r.callToken,u=a?a.token:null;return u&&(e.headers.authorization=[a.tokenType||"Bearer",u].join(" ")),n(e,t).catch(function(e){try{var t=e.headers("www-authenticate")}catch(e){console.error(e)}if(t){var n={};t.replace(/^\S+\s+/,"").split(/,/).map(function(e){return e.trim()}).forEach(function(e){var t=e.indexOf("="),i=s(t==-1?e:e.substr(0,t)),r=s(t==-1?"":e.substr(t+1));n[i]=s(r)});var r=Object.keys(n).filter(function(e){return e.match(/^(max_age|acr_values|prompt|scope)$/)}).reduce(function(e,t){return e[t]=n[t],e},{});if(Object.keys(r).length>0)return i(r);if(!o)return i({acr_values:"1"})}return Promise.reject(e)})})}var r="authorization"in e.headers;if(r)return n(e,t);var o=t.session||c.default.currentSession,a=t["uuoidc.loginParameters"];a&&(a=Object.keys(a).reduce(function(e,t){return e[d.default.toSnakeCase(t)]=a[t],e},{}));var l=0;return i(null)}function s(e){return decodeURIComponent(e.replace(/\+/g," "))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var a=n(1),u=r(a),l=n(3),c=i(l),f=n(12),d=i(f)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return(e||"").match(/^(https?:\/\/[^\/]+).*$/)[1]||null}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(10),u=i(a),l=n(2),c=i(l),f=n(1),d=f.Logging.LoggerFactory.get("UuOidc.SessionStateChangeNotifier"),h=function(){function e(t){r(this,e),this.session=t,this._listeners=[],this._checkState=this._checkState.bind(this),this._onMessage=this._onMessage.bind(this),this._init()}return s(e,[{key:"onStateChange",value:function(e){var t=this;return this._listeners.push(e),function(){var n=t._listeners.indexOf(e);return n!=-1&&t._listeners.splice(n,1),n!=-1}}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._stateCheckInterval&&clearInterval(this._stateCheckInterval),delete this._stateCheckInterval,window.removeEventListener("message",this._onMessage),this._listeners=[])}},{key:"_init",value:function(){var e=this;u.default.domReady.then(function(){if(!e._destroyed)return c.default.getMetadata(e.session.serverUri).then(function(t){var n=t.check_session_iframe;if(!n)return void console.error("The OpenID Connect server",e.session.serverUri,"doesn't support check_session_iframe (see",c.default.getMetadataUri(e.session.serverUri),").");d.debug("Creating iframe with check_session_iframe endpoint URL - "+n),e._iframeTrustedOrigin=o(n);var i=e._iframe=document.createElement("iframe");i.style.cssText="position: absolute;top: -300px; left: -300px; width: 200px; height: 200px; opacity: 0;",i.tabIndex="-1",i.onload=function(){return e._stateCheckAllowed=!0},i.src=n,document.body.appendChild(i),window.addEventListener("message",e._onMessage),e._stateCheckInterval=setInterval(e._checkState,1e3*e.session.sessionCheckInterval)})})}},{key:"_onMessage",value:function(e){d.debug("Received message from "+e.origin+": "+e.data),this._iframe&&e.source===this._iframe.contentWindow&&e.origin===this._iframeTrustedOrigin&&"changed"===e.data&&(d.info("Received session state change notification from OIDC iframe (message: '"+e.data+"')."),this._listeners.forEach(function(e){return e()}))}},{key:"_checkState",value:function(){if(this._stateCheckAllowed&&this._iframe){var e=(this.session._loginCtx||{}).authResponse;if(e&&e.session_state){var t=this.session.clientId+" "+e.session_state;d.debug("Querying session state change from OIDC iframe. Query: "+t),this._iframe.contentWindow.postMessage(t,this._iframeTrustedOrigin)}}}}]),e}();t.default=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){if(!(s.default.currentSession.isAuthenticated()||s.default.currentSession._loginInProgress>0)){var e;return location.search.replace(/[?&]access_token=([^&#]*)/,function(t,n){e=decodeURIComponent(n.replace(/\+/g," "))}),e?s.default.currentSession._login({access_token:e,nonce:null}):s.default.currentSession._login({prompt:"none",acr_values:"1"}).catch(function(e){if(!c.default.isLoggedOutError(e))throw e})}}var o=n(3),s=i(o),a=n(10),u=i(a),l=n(4),c=i(l),f=new Function("try {return this===window;}catch(e){ return false;}")();f?u.default.domReady.then(function(){return Promise.resolve(r())}).then(s.default.initPromise._finalizeInit.bind(null,!0),s.default.initPromise._finalizeInit.bind(null,!1)):s.default.initPromise._finalizeInit(!0)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHandler=t.Session=void 0;var r=n(3),o=i(r),s=n(16),a=i(s);n(18),"undefined"!=typeof window&&(window.UuOidc={Session:o.default,SessionHandler:a.default}),t.Session=o.default,t.SessionHandler=a.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(2),a=i(s),u=n(11),l=i(u),c={},f=0,d=function(){function e(t){if(r(this,e),!t||!t.serverUri)throw new Error("Jwks must be initialized with options containing serverUri.");this.options=t}return o(e,[{key:"getKey",value:function(e,t){return this._getKey(e,t,!1)}},{key:"_getKey",value:function(e,t,n){var i=this;return a.default.getMetadata(this.options.serverUri).then(function(e){var t=c[e.jwks_uri];if(!t||n){var i=e.jwks_uri;n&&(i=i.replace(/(\?.*)?$/,function(e){return"?cachebust="+Date.now().toString(36)+"_"+(f++).toString(36)+(e?"&"+e.substr(1):"")})),t=c[e.jwks_uri]=l.default.get(i).then(function(e){return{jwkSet:e,url:i}})}return t}).then(function(r){var o=r.jwkSet,s=o.keys;if(e&&(s=s.filter(function(t){return t.kid===e})),t&&(s=s.filter(function(e){return e.kty===t})),1!=s.length){if(!n)return i._getKey(e,t,!0);throw new Error("There's "+s.length+" JSON Web Key(s) in JWK Set with kid='"+e+"' kty='"+t+"'. There must be exactly 1. JWK Set has been downloaded from: "+r.url)}return s[0]})}}]),e}();t.default=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=i(r),s=n(5),a=i(s),u=n(23),l=i(u),c=n(22),f=i(c),d="undefined"!=typeof crypto&&crypto.subtle&&crypto.subtle.importKey,h=d&&("undefined"==typeof location||"https:"==location.protocol),p=h?l.default:f.default,g="RS256";t.default={decode:function(e,t,n){var i,r;return Promise.resolve().then(function(){if("string"!=typeof e)throw new Error("Invalid JSON Web Token - it must be a string (result of JWS / JWE Compact Serialization as per RFC7515 / RFC7516).");if(i=e.split("."),3!=i.length)throw new Error("Unsupported JSON Web Token - the token doesn't consist of header+body+signature (only JWS Compact Serialization is supported - RFC7515, section-3). Token: "+e);var t=i[0],s=o.default.decode(t);if(r=JSON.parse(s),"JWT"!=r.typ)throw new Error("Invalid JSON Web Token - the header 'typ' field is not set to 'JWT'. Token: "+e);return n(r)}).then(function(n){if(!n||"RSA"!=n.kty)throw new Error("Unsupported key type. Only RSA keys are supported for JSON Web Token signature verification. Key: "+JSON.stringify(n));var o=n.alg||g;if(o!==r.alg)throw new a.default("Invalid JSON Web Token or wrong verification key - algorithms don't match. Token uses '"+r.alg+"', verification key uses '"+n.alg+"' (with default of '"+g+"'). Token: "+e+" Key: "+JSON.stringify(n));return p.verify(n,o,t,r,i,e)}).then(function(t){if(!t)throw new a.default("Invalid JSON Web Token: "+e);var n=o.default.decode(i[1]),r=JSON.parse(n);return r})}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(13),o=i(r),s=((o.default?o.default.uri:(document.currentScript||Array.prototype.slice.call(document.getElementsByTagName("script"),-1)[0]||{}).src)||"").toString(),a=void 0,u={verify:function(e,t,n,i,r,o){var l=this;return Promise.resolve().then(function(){if(void 0===a){var c,f=u.verify.bind(l,e,t,n,i,r,o),d=s.indexOf(".min.")!=-1,h=s.replace(/^(.*\/).*/,"$1"),p=h+"jsrsasign"+(d?".min":"")+".js";
return c="undefined"!=typeof System?System.import(p):new Promise(function(e,t){var n=document.createElement("script");n.onload=function(){e(window.Jsrsasign)},n.onerror=function(e){t(e)},n.src=p,document.head.appendChild(n)}),c.then(function(e){return a=e||null,f()},function(e){return console.error(e),f()})}if(!a)throw new Error("Unable to verify token because jsrsasign library failed to load.");var g=a.KEYUTIL.getKey(e),m=a.jws.JWS.verifyJWT(o,g,n);return m||Promise.reject(new Error("Token is not valid. Token: "+o))})}};e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function o(e){return null==e?null:Array.isArray(e)?e:[e]}function s(e){return new Date(1e3*e).toISOString().replace(/T/," ")}var a=n(9),u=i(a),l=n(5),c=i(l);e.exports={verify:function(e,t,n,i,a,l){var f={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-"+t.substr(2)}},d=JSON.parse(JSON.stringify(e));return delete d.use,crypto.subtle.importKey("jwk",d,f,!1,["verify"]).then(function(e){var t=a[2],n=a[0]+"."+a[1],i=r(u.default.decodeToAscii(t)),o=r(n);return crypto.subtle.verify(e.algorithm,e,i,o)},function(e){var t=new Error("Unable to verify JSON Web Token - importing key via WebCrypto API failed.\nKey: "+JSON.stringify(d)+"\nToken: "+l+"\nError: "+e);return t.cause=e,Promise.reject(t)}).then(function(e){if(!e)throw new c.default("Invalid JSON Web Token - signature is not valid. Token: "+l);var t=u.default.decode(a[1]),r=JSON.parse(t),f=function(e,t){throw new c.default("Invalid token: "+e+"\nFailed claim: "+JSON.stringify(t)+"\nIssued by: "+JSON.stringify(r.iss)+"\nVerification options: "+JSON.stringify(n)+"\nToken: "+l)};if(!n.alg)throw new Error("Unable to verify JWT claim - 'alg' field must be always given for verification.");n.alg.indexOf(i.alg)==-1&&f("Algorithm "+JSON.stringify(i.alg)+" used by token is not valid - expected one of "+JSON.stringify(n.alg)+".","alg");var d;d=o(n.iss),d&&d.indexOf(r.iss)===-1&&f("Issuer URI "+JSON.stringify(r.iss)+" in token is not valid - expected one of "+JSON.stringify(d)+". Token was issued by different OpenID Connect server or it was forged.","iss"),d=o(n.sub),d&&d.indexOf(r.sub)===-1&&f("Subject "+JSON.stringify(r.sub)+" in token is not valid - expected one of "+JSON.stringify(d)+".","sub"),d=o(n.aud);var h=o(r.aud)||[];d&&h.some(function(e){return d.indexOf(e)==-1})&&f("Audience list "+JSON.stringify(h)+" in token is not valid - some of following values are missing: "+JSON.stringify(d)+".","aud");var p=Date.now()/1e3;n.verifyAt&&(p=n.verifyAt);var g=n.gracePeriod||0;return"number"==typeof r.exp&&r.exp+g<p&&f("Token already expired at "+s(r.exp)+", current time is "+s(p)+".","exp"),"number"==typeof r.nbf&&p<r.nbf-g&&f("Token is not yet valid - it will become valid at "+s(r.nbf)+", current time is "+s(p)+". Check that your system time is correctly set.","nbf"),"number"==typeof r.iat&&p<r.iat-g&&f("Token seems to have been issued in the future - "+s(r.iat)+", current time is "+s(p)+". Check that your system time is correctly set.","iat"),n.jti&&r.jti!==n.jti&&f("Token ID "+JSON.stringify(r.jti)+" not valid - expected "+JSON.stringify(n.jti)+".","jti"),!0})}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=i(r),s=function e(t){var n=Object.assign({},t),i={loginWindow:null,closeCheckInterval:null};o.default.registerForCallback(this,i),this.finalize=function(e){this.finalize=function(){},this.destroy(),n.onResult&&n.onResult(e)}.bind(this);var r=function(){i.loginWindow&&i.loginWindow.closed&&this.finalize(!1)}.bind(this);this.render=function(){var t=this;if(!i.loginWindow){var o={width:599,height:600};o.left=(screen.availWidth-o.width)/2+(screen.availLeft||0),o.top=(screen.availHeight-o.height)/2+(screen.availTop||0),i.loginWindow=window.open(n.url,"_blank","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width="+o.width+",height="+o.height+",top="+o.top+",left="+o.left),i.loginWindow?i.closeCheckInterval=setInterval(r.bind(this),200):Promise.resolve().then(function(){return t.finalize(e.ERROR_POPUP_BLOCKED)})}},this.destroy=function(){i.loginWindow&&!i.loginWindow.closed&&i.loginWindow.close(),i.closeCheckInterval&&clearInterval(i.closeCheckInterval),this.destroy=function(){},o.default.unregisterForCallback(this)}};s.ERROR_POPUP_BLOCKED="POPUP_BLOCKED",t.default=s},function(e,t){"use strict";function n(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(6),a=i(s),u=n(4),l=i(u),c=function(){function e(t){if(r(this,e),!(t&&t.serverUri&&t.clientId&&t.redirectUri))throw new Error("Os8Auth must be initialized with options containing serverUri, clientId and redirectUri.");this.options=t}return o(e,[{key:"grantExchangeToken",value:function(e){var t=e||{};if(!t.subject_token)throw new Error("Os8Auth.grantExchangeToken must be called with parameter subject_token.");var n=Object.assign({},t,{response_type:"id_token token",client_id:this.options.clientId,redirect_uri:this.options.redirectUri}),i=Object.keys(n).filter(function(e){return null!=n[e]}).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e]+"")}),r=this.options.serverUri.replace(/\/*$/,"/")+"exchangeOs8Token?"+i.join("&");return new Promise(function(e,t){new a.default({url:r,onResult:function(n){var i=l.default.getAuthResponseFromCallback(n);!i||i.error?t(i):e(i)}}).render()})}}]),e}();t.default=c}])});
//# sourceMappingURL=uu_oidcg01.min.js.map